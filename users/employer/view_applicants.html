<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Applications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: { colors: { primary: "#407bff" } } },
      };
    </script>
  </head>
  <body class="bg-gray-50 font-sans">
    <!-- NAVBAR -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <h1 class="text-2xl font-bold text-primary">Employer Panel</h1>
            <div class="hidden md:flex ml-10 space-x-8">
              <a
                href="dashboard.html"
                class="text-gray-500 hover:text-gray-700 px-1 pt-1 text-sm font-medium"
                >Dashboard</a
              >
              <a
                href="post_job.html"
                class="text-gray-500 hover:text-gray-700 px-1 pt-1 text-sm font-medium"
                >Post a Job</a
              >
              <!-- ACTIVE LINK -->
              <a
                href="applications.html"
                class="text-gray-900 border-b-2 border-primary px-1 pt-1 text-sm font-medium"
                >Applications</a
              >
            </div>
          </div>
          <button id="logoutBtn" class="text-red-500 font-medium">
            Logout
          </button>
        </div>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">
        Select a Job to View Applicants
      </h2>

      <!-- GRID OF JOBS -->
      <div
        id="jobsGrid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        <!-- JS will inject cards here -->
        <p class="text-gray-500 col-span-3 text-center py-10">
          Loading jobs...
        </p>
      </div>
    </div>

    <!-- SCRIPT -->
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        document
          .getElementById("logoutBtn")
          .addEventListener("click", async () => {
            await fetch("../../api/logout.php");
            window.location.href = "../../auth/login.html";
          });

        try {
          const res = await fetch("../../api/jobs/list_employer.php");
          const result = await res.json();
          const grid = document.getElementById("jobsGrid");
          grid.innerHTML = "";

          if (result.status && result.data.length > 0) {
            result.data.forEach((job) => {
              // Highlight jobs with applicants
              const hasApplicants = job.applicant_count > 0;
              const cardClass = hasApplicants
                ? "border-l-4 border-l-primary"
                : "border-l-4 border-l-gray-200";
              const btnClass = hasApplicants
                ? "bg-primary text-white hover:bg-blue-600"
                : "bg-gray-100 text-gray-400 cursor-not-allowed";
              const link = hasApplicants
                ? `view_applicants.html?job_id=${job.id}`
                : "#";

              const html = `
                            <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 ${cardClass} hover:shadow-md transition">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-gray-800 text-lg">${job.title}</h3>
                                        <p class="text-sm text-gray-500">${new Date(job.created_at).toLocaleDateString()}</p>
                                    </div>
                                    <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">${job.job_type}</span>
                                </div>

                                <div class="mt-6 flex items-center justify-between">
                                    <div>
                                        <span class="text-2xl font-bold ${hasApplicants ? "text-primary" : "text-gray-300"}">${job.applicant_count}</span>
                                        <span class="text-sm text-gray-500 ml-1">Applicants</span>
                                    </div>
                                    
                                    <a href="${link}" class="px-4 py-2 rounded-md text-sm font-medium transition ${btnClass}">
                                        View List <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </div>
                            </div>
                        `;
              grid.innerHTML += html;
            });
          } else {
            grid.innerHTML = `<p class="col-span-3 text-center text-gray-500">No jobs posted yet.</p>`;
          }
        } catch (err) {
          console.error(err);
        }
      });
    </script>
  </body>
</html>
